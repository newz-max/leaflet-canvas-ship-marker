var __defProp=Object.defineProperty,__defProps=Object.defineProperties,__getOwnPropDescs=Object.getOwnPropertyDescriptors,__getOwnPropSymbols=Object.getOwnPropertySymbols,__hasOwnProp=Object.prototype.hasOwnProperty,__propIsEnum=Object.prototype.propertyIsEnumerable,__defNormalProp=(t,e,n)=>e in t?__defProp(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,__spreadValues=(t,e)=>{for(var n in e||(e={}))__hasOwnProp.call(e,n)&&__defNormalProp(t,n,e[n]);if(__getOwnPropSymbols)for(var n of __getOwnPropSymbols(e))__propIsEnum.call(e,n)&&__defNormalProp(t,n,e[n]);return t},__spreadProps=(t,e)=>__defProps(t,__getOwnPropDescs(e)),__publicField=(t,e,n)=>(__defNormalProp(t,"symbol"!=typeof e?e+"":e,n),n);!function(t){"function"==typeof define&&define.amd?define(t):t()}((function(){"use strict";var t;t=function(){L.Canvas.CustomCanvas=L.Layer.extend({initialize(t={}){L.setOptions(this,t)},onAdd(t){this.tiles={},this._container=t.getContainer(),this._map=t;const e=this._initCanvas();(this.options.pane?t.getPanes()[this.options.pane]:t._panes.overflowPane).appendChild(e),t.on(this.getEvents(),this),this._update()},onRemove(){const{_map:t,_ctx:e,_canvas:n}=this;n.remove()},_initCanvas(){const t=L.DomUtil.create("canvas","leaflet-ship"),e=t.getContext("2d");t.style.zIndex=this.options.zIndex||"500",this._canvas=t,this._ctx=e,this._onLayerDidResize();var n=this._map.options.zoomAnimation&&L.Browser.any3d;return L.DomUtil.addClass(this._canvas,"leaflet-zoom-"+(n?"animated":"hide")),t},_onAnimZoom(t){var e=this._map.getZoomScale(t.zoom),n=this._map._latLngBoundsToNewLayerBounds(this._map.getBounds(),t.zoom,t.center).min;L.Browser.any3d?L.DomUtil.setTransform(this._canvas,n,e):L.DomUtil.setPosition(this._canvas,n)},_onLayerDidResize:function(){const{x:t,y:e}=this._map.getSize();this._canvas.style.width=`${t}px`,this._canvas.style.height=`${e}px`,this._canvas.width=2*t,this._canvas.height=2*e},_onLayerDidMove:function(){this._update()},getEvents(){var t={resize:this._onLayerDidResize,moveend:this._onLayerDidMove};return this._zoomAnimated&&(t.zoomanim=this._onAnimZoom),t},_update(){const{_ctx:t,_map:e,_canvas:n}=this,o=e.containerPointToLayerPoint([0,0]);L.DomUtil.setPosition(n,o),this.clearCavnas(t,n),this.drawLayer()},drawLayer:function(){console.warn("如自定义新的继承类，请实现此方法")},clearCavnas(t,e){t.restore();const{width:n,height:o}=e;t.clearRect(0,0,n,o)}})},"function"==typeof define&&define.amd?define(t):t();class e extends L.Canvas.CustomCanvas{constructor(){super(...arguments),__publicField(this,"_instance",null)}drawLayer(){const{options:{latlngs:t},_map:e}=this;this._ctxs=[];const n=t.map((t=>{const n={};t.latlng||(n.lat=t.lat,n.lng=t.lng);return{latlng:e.latLngToContainerPoint(n),deg:t.deg||0,type:t.type,color:t.color}})).map((t=>__spreadProps(__spreadValues({},t),{latlng:{x:2*t.latlng.x,y:2*t.latlng.y}})));this._ctxPoints=n,this.drawShip(n),this._initEvents()}drawShip(t){const{_ctx:e}=this,n={base(t,n){let{x:o,y:s}=t.latlng;((t,e,n,o)=>{t.restore(),t.translate(0,0),t.save(),t.translate(e,n),t.rotate(o*Math.PI/180)})(e,o,s,t.deg),e.beginPath(),e.lineWidth=2,e.moveTo(0,-20),e.lineTo(0,-20),e.lineTo(7,-10),e.lineTo(7,20),e.lineTo(-7,20),e.lineTo(-7,-10),e.lineTo(0,-20)},running(t){this.base(t),e.lineTo(0,-35)},turn(t){this.base(t),e.lineTo(0,-35),e.lineTo(10,-35)},lost(t){this.base(t),t.color="#e9e9e9"},storage(t){let{x:n,y:o}=t.latlng;return e.beginPath(),e.arc(n,o,18,0,2*Math.PI),e.stroke(),e.moveTo(n+10,o),e.arc(n,o,11,0,2*Math.PI),e.stroke(),t.color=!0,e},end:t=>(e.fillStyle=t.color||"#ffff54",e.fill(),e.stroke(),e)};t.forEach((t=>{if(n[t.type](t),"storage"===t.type){const e=n[t.type](t);return void this._ctxs.push(e)}const e=n.end(t);this._ctxs.push(e)}))}canvasDomEvent(t){const{_ctxs:e,_ctxPoints:n}=this;return console.log(n,"_ctxPoints"),t()}_initEvents(){const{_ctxs:t,_ctx:e,options:{events:n={}},_canvas:o}=this,s=Object.entries(n);s.length,s.forEach((t=>{const e=t[0],n=t[1];console.log(e,"eventKey"),o.removeEventListener(e,this.canvasDomEvent),o.addEventListener(e,this.canvasDomEvent(n))}))}}L.canvas.CanvasShip=t=>new e(t)}));
